---
output: 
  pdf_document:
      number_sections: true
fontsize: 12pt
geometry: margin=2.3cm
header-includes:
  - \usepackage{fancyhdr}  # Custom headers/footers
  - \pagestyle{fancy}       # Enable fancy headers/footers
  - \fancyhf{}              # Clear default headers
  - \lfoot{`r Sys.Date()`}    # Left footer: Author name(s)
  - \rfoot{Page \thepage}   # Right footer: Page number
  - \cfoot{Nathann Morand, Felipe Ramirez, Gautier Demierre} # Center footer
  - \thispagestyle{fancy}   # Ensure first page gets the footer too
---

# A1-10, ANOVA Potato

## Introduction
This study investigates the cooking quality of Oregon-grown Russet potatoes. Specifically, it examines how different growing areas, storage conditions, and cooking methods affect the flavor of the potatoes. The `Flavor score` is modeled as a function of:

- **Growing Area**: Southern Oregon vs. Central Oregon
- **Two-week Holding Temperature**: 75°F vs. 40°F
- **Size**: Large vs. Medium
- **Storage Period**: 0, 2, 4, and 6 months
- **Cooking Method**: Boiling, Steaming, Mashing, Baking at 350°F, Baking at 450°F


```{r, echo=FALSE, message=FALSE, warning=FALSE}

# Load required libraries
library(knitr)
library(kableExtra)
library(dplyr)
library(tibble)

# Load data
potato <- read.table("potato.dat", header = FALSE)
colnames(potato) <- c("Area", "Temp", "Size", "Storage", "Cooking", "Texture", "Flavor",  "Moistness")
#str(potato)

#sum(is.na(potato))

# Convert categorical variables to factors with meaningful labels
potato$Area <- factor(potato$Area, levels = c(1, 2), labels = c("Southern Oregon", "Central Oregon"))
potato$Temp <- factor(potato$Temp, levels = c(1, 2), labels = c("75°F", "40°F"))
potato$Size <- factor(potato$Size, levels = c(1, 2), labels = c("Large", "Medium"))
potato$Storage <- factor(potato$Storage, levels = c(1, 2, 3, 4), labels = c("0 months", "2 months", "4 months", "6 months"))
potato$Cooking <- factor(potato$Cooking, levels = c(1, 2, 3, 4, 5), labels = c("Boil", "Steam", "Mash", "Bake@350°F", "Bake@450°F"))

```

## Exploratory Data Analysis (EDA)
### Summary Statistics
```{r, echo=FALSE, , message=FALSE, warning=FALSE}

# Split dataset into categorical and numerical subsets
categorical_vars <- potato[, sapply(potato, is.factor)]
numeric_vars <- potato[, c("Texture", "Flavor", "Moistness")]  # Select only the 3 numeric variables

# Compute summary statistics (Min, 1st Quartile, Median, Mean, 3rd Quartile, Max)
summary_numeric <- numeric_vars %>%
  summarise(
    Min = sapply(., min, na.rm = TRUE),
    `1st Quartile` = sapply(., quantile, probs = 0.25, na.rm = TRUE),
    Median = sapply(., median, na.rm = TRUE),
    Mean = sapply(., mean, na.rm = TRUE),
    `3rd Quartile` = sapply(., quantile, probs = 0.75, na.rm = TRUE),
    Max = sapply(., max, na.rm = TRUE)
  )

# Transpose for better readability
summary_num_df <- summary_numeric %>%
  t() %>%
  as.data.frame() %>%
  rownames_to_column(var = "Statistic")

# Rename columns properly
colnames(summary_num_df) <- c("Statistic", "Texture", "Flavor", "Moistness")

# Format numeric values to 2 significant digits
summary_num_df[, 2:4] <- lapply(summary_num_df[, 2:4], function(x) format(round(as.numeric(x), 2), nsmall = 2))

# Display categorical summary (Transposed)
summary_categorical <- lapply(categorical_vars, summary)
summary_cat_df <- bind_rows(lapply(summary_categorical, function(x) as.data.frame(t(x))), .id = "Variable")

# Replace NA values with whitespace
summary_cat_df[is.na(summary_cat_df)] <- ""

# Display categorical table with 90° rotated headers
kable(summary_cat_df, caption = "Summary Statistics (Categorical Variables)", longtable = TRUE) %>%
  kable_styling(latex_options = c("hold_position", "repeat_header")) %>%
  row_spec(0, angle = 90)  # Rotate column headers to 90°

# Display numeric summary with row grouping in sets of 5
kable(summary_num_df, caption = "Summary Statistics (Numeric Variables)", longtable = TRUE, booktabs = TRUE) %>%
  kable_styling(latex_options = c("hold_position", "repeat_header")) %>%
  row_spec(0, angle = 0)  # Rotate column headers to 90°
```

### Visualizations
```{r, echo=FALSE}
# Boxplot of Flavor score by Cooking Method
boxplot(Flavor ~ Cooking, data = potato, main = "Flavor Score by Cooking Method",
        xlab = "Cooking Method", ylab = "Flavor Score")

# Interaction Plot
interaction.plot(potato$Storage, potato$Cooking, potato$Flavor,
                 xlab = "Storage Period", ylab = "Mean Flavor Score",
                 trace.label = "Cooking Method")
```

## Model Fitting
```{r, echo=FALSE}
# Fit ANOVA model
anova_model <- aov(Flavor ~ Area + Temp + Size + Storage + Cooking, data = potato)
summary(anova_model)
```

### Model Selection
```{r, echo=FALSE}
# Stepwise model selection based on AIC
step(anova_model)
```

## Model Assessment
```{r, echo=FALSE}
par(mfrow = c(2,2))
plot(anova_model)  # Residual plots
```

## Results & Conclusion
```{r, echo=FALSE}
# Extracting significant factors
summary(anova_model)
```

This analysis confirms that cooking method and storage conditions significantly impact potato flavor. Baking at 350°F generally produces the best flavor, while extended storage at 40°F may reduce desirable taste characteristics.
